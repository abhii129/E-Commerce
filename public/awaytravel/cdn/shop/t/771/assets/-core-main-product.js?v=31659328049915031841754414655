import{B as T}from"./chunk-BaseElement-CopzcQ-j.js";import{V as A}from"./chunk-variant-picker-CX2bkI1w.js";import"./chunk-quantity-input-BDeZ0iZt.js";import{H as C}from"./chunk-HTMLUpdateUtility-Hp59CDcg.js";import{t as I}from"./chunk-custom-element-BhZVzxrc.js";import{n as l}from"./chunk-property-Bc0RexEQ.js";import"./chunk-lit-element-B04JoW0t.js";import"./chunk-WithShopifyCart-Bw08p0rZ.js";import"./chunk-WithApiClient-mq4vOvoR.js";import"./chunk-index-CKJCYK2x.js";import"./chunk-cart-sections-DQ33OuN-.js";import"./chunk-create-context-89xeped_.js";import"./chunk-tracking-DO2MhGcG.js";import"./chunk-consume-B27YesmA.js";import"./chunk-context-request-event-GdmzvDV-.js";import"./chunk-state-BZNsAlxZ.js";import"./chunk-ref-7xufm7YO.js";import"./chunk-directive-C_Rw-dL6.js";import"./chunk-moneyFormatter-CIg0BGM2.js";import"./chunk-FormElement-1RsIGsWP.js";import"./chunk-debounce-D6ZMjh7U.js";import"./chunk-LiveRegionUtility-tvV1eypT.js";import"./chunk-aria-live-region-context-DAmBJh4s.js";import"./chunk-firstFocusableElement-BqnhZP5g.js";function B(t){if(t)return/Googlebot|Mediapartners-Google|AdsBot-Google|googleweblight|Storebot-Google|Google-PageRenderer|Google-InspectionTool|Bingbot|BingPreview|Slurp|DuckDuckBot|baiduspider|yandex|sogou|LinkedInBot|bitlybot|tumblr|vkShare|quora link preview|facebookexternalhit|facebookcatalog|Twitterbot|applebot|redditbot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|ia_archiver|Yeti/i.test(t)}const F=t=>{var r;if(t!=null&&t.textContent)try{const a=JSON.parse(t.textContent),e=a?.productVariant,i=e?.product,n=((r=e?.price)==null?void 0:r.amount)??0;setTimeout(()=>{window.ElevarDataLayer=window.ElevarDataLayer||[],window.ElevarDataLayer.push({event:"dl_user_data"})},0),setTimeout(()=>{var s,u,c,p,m;window.ElevarDataLayer=window.ElevarDataLayer||[],window.ElevarDataLayer.push({event:"dl_view_item",ecommerce:{currencyCode:((s=e?.price)==null?void 0:s.currencyCode)||"USD",detail:{products:[{brand:i?.vendor??"",category:i?.type??"",compare_at_price:(((u=e?.compare_at_price)==null?void 0:u.amount)??n).toFixed(2),id:e?.sku??"",image:((c=e?.image)==null?void 0:c.src)??"",name:i?.title??"",price:n.toFixed(2),product_id:((p=i?.id)==null?void 0:p.toString())??"",variant:e?.title??"",variant_id:((m=e?.id)==null?void 0:m.toString())??""}]}}})},0)}catch(a){console.warn("Error parsing dl_view_item data:",a)}},H=(t,r=300)=>{let a=Date.now();return()=>{a+r-Date.now()<=0&&(t(),a=Date.now())}};var M=Object.defineProperty,k=Object.getOwnPropertyDescriptor,d=(t,r,a,e)=>{for(var i=e>1?void 0:e?k(r,a):r,n=t.length-1,s;n>=0;n--)(s=t[n])&&(i=(e?s(r,a,i):s(i))||i);return e&&i&&M(r,a,i),i};let o=class extends T{constructor(){super(),this.$htmlUpdateUtility=new C(this),this.rerenderBelowTheFold=!1,this.isPDPMainProduct=!1,this.isBundleProduct=!1,this.isGiftCardTemplate=!1,this.throttledHandleBelowTheFoldUpdate=H((t,r)=>{this.handleBelowTheFoldUpdate(t,r)},200),this.boundHandleVariantPickerChange=this.handleVariantPickerChange.bind(this)}connectedCallback(){super.connectedCallback(),this.setAtcLoadingState=this.setAtcLoadingState.bind(this),this.addEventListener(A,this.boundHandleVariantPickerChange),this.$htmlUpdateUtility.addPostProcessCallback(()=>{var t,r;(r=(t=window?.Shopify)==null?void 0:t.PaymentButton)==null||r.init()})}firstUpdated(t){super.firstUpdated(t),!B(navigator.userAgent)&&(document.readyState==="complete"||document.readyState==="interactive")&&this.handleFirstTimeVisit()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(A,this.boundHandleVariantPickerChange)}handleFirstTimeVisit(){if(!this.isPDPMainProduct||this.isBundleProduct||this.isGiftCardTemplate)return;const t=o.STORAGE_KEYS.FIRST_VISIT;localStorage.getItem(t)==="true"?(this.updateProductDetails(),this.addHybridParam()):this.cleanupFeaturedCollectionParams()}async updateProductDetails(){const t=`${this.productUrl}?${o.URL_PARAMS.VIEW}=${o.URL_VALUES.FEATURED_COLLECTION}`,r=await fetch(t);if(!r.ok)return;const a=await r.text(),n=new DOMParser().parseFromString(a,"text/html").body,s=document.body;await this.$htmlUpdateUtility.replace(s,n,0,!0)}addHybridParam(){const t=new URL(window.location.href);t.searchParams.get(o.URL_PARAMS.VIEW)!==o.URL_VALUES.HYBRID_PDP&&(t.searchParams.append(o.URL_PARAMS.VIEW,o.URL_VALUES.HYBRID_PDP),window.history.pushState({},"",t.toString()))}cleanupFeaturedCollectionParams(){const t=new URL(window.location.href);t.searchParams.get(o.URL_PARAMS.CHANGE)===o.URL_VALUES.FEATURES&&(t.searchParams.delete(o.URL_PARAMS.CHANGE),window.history.replaceState({},"",t.toString()))}updateURL(t,r,a){if(!this.shouldUpdateUrl)return;const e=[r?`variant=${r}`:"",a?`${a}`:""].filter(i=>!!i);window.history.replaceState({},"",`${t}${e.length>0?"?":""}${e.join("&")}`)}setAtcLoadingState(t){const r=t!=null&&t.loading?"add":"remove",a=this.querySelector("[data-add-to-cart-button]");a&&a.classList[r]("btn-loading")}handleVariantPickerChange(t){var g,S,y;this.classList.add("loading"),(g=this.querySelector("[data-media-gallery]"))==null||g.classList.add("media-loading");const r=new URLSearchParams(window.location.search),a=r.get("additional-product");if(t.detail.target.id.indexOf("psn")>-1&&a)return;const e=r.get("modals");e==="psn"&&r.delete("variant");const i=t.detail.productUrl,n=t.detail.variantId,s=t.detail.hasSingleVariant,u=t.detail.price,c=t.detail.target.dataset.variantImage;if(!n||n.trim()==="")return;this.updateURL(i??"",s?void 0:n,e?r.toString():void 0),i&&i!==""&&i!==this.productUrl&&(this.productUrl=i);const p=this.querySelector(".gift-card-image");p&&c&&(p.src=c,p.srcset=`${c} 800w`);const m=(S=this.querySelector("variant-picker"))!=null&&S.id.includes("psn-unique")?100:0;this.id=="psn-product"&&((y=this.closest("psn-provider"))==null||y.classList.add("loading")),this.bundleEnableSwatches&&(this.view="swatches"),this.isPDPMainProduct&&this.setAtcLoadingState({loading:!0}),this.$htmlUpdateUtility.fetchAndReplaceSectionId({renderRoot:this,sectionId:this.sectionId,baseUrl:i||this.productUrl,params:{variant:n||"",...this.view?{view:this.view}:{}},withCache:!0,delay:m,forceReplaceAll:this.sectionId==="product-card--bundle"}).then(()=>{var v,L,E,R;this.classList.remove("loading"),(v=this.querySelector("[data-media-gallery]"))==null||v.classList.remove("media-loading");const h=document.querySelector("#theme-head title"),w=document.querySelector("#meta-title");h&&w&&(h.innerHTML=w?.innerHTML);const P=document.querySelector("#theme-head meta[name='description']"),f=(L=document.querySelector("#meta-description"))==null?void 0:L.innerHTML;P&&f&&(P.content=f);const U=new CustomEvent("main-product-change-complete",{bubbles:!0,composed:!0,detail:{productUrl:i,variantId:n,price:u}});this.dispatchEvent(U);const b=this.querySelector("[data-tracking-product]");if(b&&this.isPDPMainProduct&&F(b),this.isPDPMainProduct&&!window.location.search.includes("psn")&&((E=document.getElementById("psn"))==null||E.setAttribute("url",this.productUrl+"?view=psn")),this.rerenderBelowTheFold&&i&&this.throttledHandleBelowTheFoldUpdate(i,n),e){const _=U.detail.variantId;(R=document.querySelector(`[is-pdp-main-product] [data-variant-id="${_}"]`))==null||R.click()}}).catch(h=>{h instanceof Error?console.error("Error during section replacement:",h):console.warn("An unexpected error occurred:",h)})}handleBelowTheFoldUpdate(t,r){this.$emit("update-below-fold",{productUrl:t,variantId:r})}};o.STORAGE_KEYS={ORIGINAL_REFERRER:"awayOriginalReferrer",FIRST_VISIT:"isFirstVisit"},o.URL_PARAMS={VIEW:"view",CHANGE:"change"},o.URL_VALUES={FEATURED_COLLECTION:"featured-collection",FEATURES:"features",HYBRID_PDP:"hybrid-pdp"},d([l({type:String,attribute:"section-id"})],o.prototype,"sectionId",2),d([l({type:String,attribute:"product-url"})],o.prototype,"productUrl",2),d([l({type:String,attribute:"view"})],o.prototype,"view",2),d([l({type:Boolean,attribute:"rerender-below-the-fold"})],o.prototype,"rerenderBelowTheFold",2),d([l({type:Boolean,attribute:"is-pdp-main-product"})],o.prototype,"isPDPMainProduct",2),d([l({type:Boolean,attribute:"is-bundle-product"})],o.prototype,"isBundleProduct",2),d([l({type:Boolean,attribute:"bundle-enable-swatches"})],o.prototype,"bundleEnableSwatches",2),d([l({type:Boolean,attribute:"is-gift-card-template"})],o.prototype,"isGiftCardTemplate",2),d([l({type:String,attribute:"update-url",converter:t=>t==="true"})],o.prototype,"shouldUpdateUrl",2),o=d([I("main-product")],o);
//# sourceMappingURL=/cdn/shop/t/771/assets/-core-main-product.js.map?v=31659328049915031841754414655
