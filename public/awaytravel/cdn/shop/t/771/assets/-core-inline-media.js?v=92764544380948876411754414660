import{B as S}from"./chunk-BaseElement-CopzcQ-j.js";import{H as g}from"./chunk-hls-Cx0E5yqS.js";import{t as w}from"./chunk-custom-element-BhZVzxrc.js";import{n as m}from"./chunk-property-Bc0RexEQ.js";import{r as y}from"./chunk-query-async-BsMZa7Mb.js";import"./chunk-lit-element-B04JoW0t.js";import"./chunk-base-CShCMygk.js";var E=Object.defineProperty,P=Object.getOwnPropertyDescriptor,n=(t,e,a,s)=>{for(var i=s>1?void 0:s?P(e,a):e,h=t.length-1,d;h>=0;h--)(d=t[h])&&(i=(s?d(e,a,i):d(i))||i);return s&&i&&E(e,a,i),i},b=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},p=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},l=(t,e,a)=>(b(t,e,"access private method"),a),c,v,o,f,u,_;let r=class extends S{constructor(){super(),p(this,c),p(this,o),p(this,u),this.loaded=!1,this.playing=!1,this.muted=!0,this._handlePlayState=this._handlePlayState.bind(this),this._handleVolumeToggle=this._handleVolumeToggle.bind(this),this.play=this.play.bind(this),this.init=this.init.bind(this),this.observer=null}async connectedCallback(){super.connectedCallback();const t=await this.playToggle;t==null||t.addEventListener("click",this._handlePlayState);const e=await this.volumeToggle;e==null||e.addEventListener("click",this._handleVolumeToggle),this._attachHTMLVideoEvents(),this.observer=new IntersectionObserver(s=>{s.forEach(i=>{i.isIntersecting?this.init().then(()=>this.play()):this.pause()})},{threshold:.25});const a=await this.video;this.observer.observe(a)}async init(){const t=await this.video;if(!t||this.loaded)return;if(!g.isSupported()){t.querySelectorAll("source").forEach(i=>{i.src=i.dataset.src||""});return}const e=t.querySelector('source[type="application/x-mpegURL"]');if(!(e&&e.dataset.src))return;const a=new g;a.loadSource(e.dataset.src||""),a.attachMedia(t),this.loaded=!0}play(){this.playing||l(this,u,_).call(this)}pause(){this.playing&&l(this,c,v).call(this)}_handlePlayState(){this.playing?this.pause():this.play()}_handleVolumeToggle(){this.video.then(t=>{t.muted=!t.muted,this.muted=t.muted})}getVideoPlayState(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}async _attachHTMLVideoEvents(){const t=await this.video;t&&(this.playing=this.getVideoPlayState(t),this.muted=t.muted,t.addEventListener("pause",()=>{this.playing=!1}),t.addEventListener("play",()=>{this.playing=!0}),t.addEventListener("playing",()=>{this.playing=!0}))}};c=new WeakSet;v=function(){return l(this,o,f).call(this,!1)};o=new WeakSet;f=async function(t=!0){const e=await this.video;t?e==null||e.play():e==null||e.pause()};u=new WeakSet;_=function(){return l(this,o,f).call(this,!0)};n([m({reflect:!0,attribute:"playing"})],r.prototype,"playing",2);n([m({reflect:!0,attribute:"muted"})],r.prototype,"muted",2);n([y("video")],r.prototype,"video",2);n([y("[play-toggle]")],r.prototype,"playToggle",2);n([y("[volume-toggle]")],r.prototype,"volumeToggle",2);r=n([w("inline-media")],r);
