var c=Object.defineProperty;var h=(s,r,t)=>r in s?c(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var n=(s,r,t)=>(h(s,typeof r!="symbol"?r+"":r,t),t);import{a as d}from"./-core-load-intersecting.js";import{B as m}from"./chunk-BaseElement-CopzcQ-j.js";import{d as u,O as p}from"./chunk-debounce-D6ZMjh7U.js";import{H as f}from"./chunk-HTMLUpdateUtility-Hp59CDcg.js";import"./chunk-lit-element-B04JoW0t.js";import"./chunk-WithApiClient-mq4vOvoR.js";import"./chunk-index-CKJCYK2x.js";import"./chunk-firstFocusableElement-BqnhZP5g.js";class b extends m{constructor(){super();n(this,"$htmlUpdateUtility",new f(this,["open"]));n(this,"sectionId","");n(this,"params","");n(this,"loading",!1);n(this,"updateUrl",!0);this.onChangeHandler=this.onChangeHandler.bind(this),this.onSubmitHandler=this.onSubmitHandler.bind(this),this._handleDebounceChange=u(this.onChangeHandler,p)}static get properties(){return{sectionId:{type:String,attribute:"section-id"},params:{type:String},loading:{type:Boolean,reflect:!0},baseUrl:{type:String,reflect:!0,attribute:"base-url"},updateUrl:{type:Boolean,attribute:"update-url",converter:t=>t==="true"}}}connectedCallback(){super.connectedCallback(),this.facetForm=this.querySelector("form"),this.facetForm.addEventListener("change",this._handleDebounceChange),this.facetForm.addEventListener("submit",this.onSubmitHandler),this.$htmlUpdateUtility.addPostProcessCallback(()=>{this.loading=!1}),this.initializeClearButtonListener()}updateURLHash(t){this.updateUrl?history.pushState({searchParams:t},"",`${this.baseUrl}${t&&"?".concat(t)}`):this.$emit("update-url",t)}get paramsObjectFromString(){return[...new URLSearchParams(this.params).entries()].reduce((a,[e,i])=>({...a,[e]:[...a[e]||[],i]}),{})}createSearchParams(t,a){const e=new FormData(t);for(const[i,o]of e.entries())(!o||o===""||i.indexOf("accordion-input")>-1||i==="filters")&&e.delete(i);return a&&e.append("q",a),new URLSearchParams(e).toString()}onChange(t={}){this.params=t,this.loading=!0;const a=document.getElementById("collection-in-pdp"),e=a==null?void 0:a.getAttribute("base-url");this.$htmlUpdateUtility.fetchAndReplaceSectionId({renderRoot:this,sectionId:this.sectionId,baseUrl:e||this.baseUrl,params:this.paramsObjectFromString,includeExistingParams:!1,withCache:!0}).catch(i=>{if(i instanceof Error)throw i;console.warn(i)})}onChangeHandler(t){var o;if(t.preventDefault(),t.target.id.indexOf("accordion-checkbox")>-1)return;const e=new URLSearchParams(window.location.search),i=e.get("q");if((o=t.detail)!=null&&o.submit){const l=new URLSearchParams(e);l.set(t.detail.name,t.detail.value),this.onChange(l.toString()),this.onSubmit()}else this.onChange(this.createSearchParams(this.facetForm,i))}initializeClearButtonListener(){const t=this.querySelector(".js-clear-btn");t&&t.dataset.searchReset!=="true"&&t.addEventListener("click",this.onClearFilters.bind(this))}onClearFilters(t){t.preventDefault(),this.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!1,e.removeAttribute("disabled")}),this.onChange()}onSubmit(){this.updateURLHash(this.params);const t=document.getElementById("collection");this.$htmlUpdateUtility.fetchAndReplaceSectionId({renderRoot:t,sectionId:t==null?void 0:t.dataset.sectionId,baseUrl:this.baseUrl,params:this.paramsObjectFromString,includeExistingParams:!1,withCache:!0}).catch(a=>{if(a instanceof Error)throw a;console.warn(a)}).finally(()=>{d()})}onSubmitHandler(t){t.preventDefault(),this.onSubmit(),this.$emit("modal-dialog::close","filter-drawer-dialog")}}window.customElements.define("facet-filters-form",b);
