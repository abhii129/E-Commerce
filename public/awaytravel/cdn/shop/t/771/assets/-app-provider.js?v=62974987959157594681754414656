import{c as S,A as c}from"./chunk-aria-live-region-context-DAmBJh4s.js";import{c as _,a as D}from"./chunk-cart-sections-DQ33OuN-.js";import{c as v}from"./chunk-deferred-media-Clw3gdQB.js";import{m as b}from"./chunk-modal-context-CA9qKp2P.js";import{I as f}from"./chunk-inView-DRPl26TR.js";import{T as A,a as g,b as C,h as L,c as w,d as P}from"./chunk-tracking-DO2MhGcG.js";import{e as l}from"./chunk-provide-C28dEjUe.js";import{r as R}from"./chunk-lit-element-B04JoW0t.js";import{t as T}from"./chunk-custom-element-BhZVzxrc.js";import{r as n}from"./chunk-state-BZNsAlxZ.js";import"./chunk-create-context-89xeped_.js";import"./chunk-context-request-event-GdmzvDV-.js";import"./chunk-property-Bc0RexEQ.js";var k=Object.defineProperty,M=Object.getOwnPropertyDescriptor,d=(e,t,a,i)=>{for(var o=i>1?void 0:i?M(t,a):t,E=e.length-1,p;E>=0;E--)(p=e[E])&&(o=(i?p(t,a,o):p(o))||o);return i&&o&&k(t,a,o),o};const s={OPEN:"modal-dialog::open",CLOSE:"modal-dialog::close",CLOSE_ALL:"modal-dialog::close-all"},h={UPDATED:"cart:updated",UPDATED_SECTIONS:"cart:updated-sections"},m={PAUSE:"deferred-media::pause",PLAY:"deferred-media::play"},u="modals",y=["step","parent-product","additional-product","letters","placement","font-color","shadow-color","font-style","font-color-hex","shadow-color-hex"];let r=class extends R{constructor(){super(),this.boundTrackClickHandlers=new Map,this.cart=window.__CART__,this.cartSections={},this.modals=[],this.activeDeferredMedia=null,this.trackClickElements=[],this.trackScrolledIntoViewElements=[],this.trackScrollDepthElement=null,this._updateFirstTimeVisit(),this.trackClickElements=this.querySelectorAll(`[${A}]`),this.trackScrolledIntoViewElements=this.querySelectorAll(`[${g}]`),this.trackScrollDepthElement=this.querySelector(`[${C}]`),this.boundHandleCartUpdate=this._handleCartUpdate.bind(this),this.boundHandleCartSectionsUpdate=this._handleCartSectionsUpdate.bind(this),this.boundHandleAriaLiveRegionSet=this._handleAriaLiveRegionSet.bind(this),this.boundHandleAriaLiveRegionClear=this._handleAriaLiveRegionClear.bind(this),this.boundHandleDeferredMediaPause=this._handleDeferredMediaPause.bind(this),this.boundHandleDeferredMediaPlay=this._handleDeferredMediaPlay.bind(this),this.boundHandleDialogSchemaClick=this._handleDialogSchemaClick.bind(this),this.boundHandleDialogEvent=this._handleDialogEvent.bind(this),this.boundWindowScroll=this._handleWindowScroll.bind(this)}createRenderRoot(){return this}connectedCallback(){this.addEventListener(h.UPDATED,this.boundHandleCartUpdate),this.addEventListener(h.UPDATED_SECTIONS,this.boundHandleCartSectionsUpdate),this.addEventListener(c.SET,this.boundHandleAriaLiveRegionSet),this.addEventListener(c.CLEAR,this.boundHandleAriaLiveRegionClear),this.addEventListener(m.PAUSE,this.boundHandleDeferredMediaPause),this.addEventListener(m.PLAY,this.boundHandleDeferredMediaPlay),this.addEventListener("click",this.boundHandleDialogSchemaClick),Object.values(s).forEach(e=>{this.addEventListener(e,this.boundHandleDialogEvent)}),this._handleRestoreModals(),this.trackClickElements.forEach(e=>{const t=()=>L(e);e.addEventListener("click",t),this.boundTrackClickHandlers.set(e,t)}),this.trackScrolledIntoViewElements.forEach(e=>f.observe(e,()=>w(e))),window.addEventListener("scroll",this.boundWindowScroll)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(h.UPDATED,this.boundHandleCartUpdate),this.removeEventListener(h.UPDATED_SECTIONS,this.boundHandleCartSectionsUpdate),this.removeEventListener(c.SET,this.boundHandleAriaLiveRegionSet),this.removeEventListener(c.CLEAR,this.boundHandleAriaLiveRegionClear),this.removeEventListener(m.PAUSE,this.boundHandleDeferredMediaPause),this.removeEventListener(m.PLAY,this.boundHandleDeferredMediaPlay),this.removeEventListener("click",this.boundHandleDialogSchemaClick),Object.values(s).forEach(e=>{this.removeEventListener(e,this.boundHandleDialogEvent)}),this.trackClickElements.forEach(e=>{const t=this.boundTrackClickHandlers.get(e);t&&e.removeEventListener("click",t)}),this.boundTrackClickHandlers.clear(),this.trackScrolledIntoViewElements.forEach(e=>f.unobserve(e)),window.removeEventListener("scroll",this.boundWindowScroll)}_handleDeferredMediaPlay(e){const t=e.composedPath(),a=t.length>0?t[0]:e.target;a===this.activeDeferredMedia||a.tagName!=="DEFERRED-MEDIA"||(this.activeDeferredMedia=a)}_handleDeferredMediaPause(){this._pauseAllDeferredMedia()}_handleCartUpdate(e){e.detail&&(this.cart=e.detail)}_handleCartSectionsUpdate(e){e.detail&&(this.cartSections=e.detail||{})}_handleDialogSchemaClick(e){const t=e.composedPath(),a=t.length>0?t[0]:e.target;if(a.tagName==="A"){const i=a.getAttribute("href");if(i&&(i.startsWith("modal-dialog://")||i.startsWith("#modal-dialog://"))){e.preventDefault();const o=i.replace("modal-dialog://","").replace("#","");o&&this._handleDialogEvent(new CustomEvent(s.OPEN,{detail:o}))}}}_handleDialogEvent(e){let t=[...this.modals];switch(e.type){case s.OPEN:e.detail&&(t=[...t,e.detail]);break;case s.CLOSE:e.detail&&(t=t.filter(a=>a!==e.detail));break;case s.CLOSE_ALL:t=[];break}t=[...new Set(t)],this.modals=t,this._applyModalsState(),this._pauseAllDeferredMedia(),this._updateQueryParams()}_pauseAllDeferredMedia(){try{if(this.activeDeferredMedia===null){Array.from(this.querySelectorAll("deferred-media")).forEach(t=>t.pause(!0));return}this.activeDeferredMedia=null}catch(e){console.error(e)}}async _applyModalsState(){await customElements.whenDefined("modal-dialog");const e=this.modals,t=Array.from(this.querySelectorAll("modal-dialog")),a=window.innerWidth-document.body.getBoundingClientRect().width;document.documentElement.style.setProperty("--scrollbar-width",`${a}px`);for(const i of t)e.includes(i.id)?i.show():i.hide()}_handleRestoreModals(){const t=new URLSearchParams(window.location.search).get(u);if(t){if(t==="cart-drawer-dialog")return;this.modals=t.split(",").map(a=>a.trim()).filter(Boolean),this._applyModalsState()}}_handleWindowScroll(){this.trackScrollDepthElement&&P(this.trackScrollDepthElement)}_updateFirstTimeVisit(){const e="isFirstVisit",t=localStorage.getItem(e)===null;localStorage.setItem(e,String(t))}_updateQueryParams(){const e=new URLSearchParams(window.location.search),t=this.modals,a=this.modals.join(",");if(t.length>0)e.set(u,a);else{e.delete(u);for(const o of y)e.delete(o)}const i=`${window.location.pathname}?${e.toString()}`;window.history.replaceState({},"",i)}_handleAriaLiveRegionSet(e){e.detail&&(this.ariaLiveRegion=e.detail)}_handleAriaLiveRegionClear(){this.ariaLiveRegion={message:""}}};d([l({context:_}),n()],r.prototype,"cart",2);d([l({context:D}),n()],r.prototype,"cartSections",2);d([l({context:b}),n()],r.prototype,"modals",2);d([l({context:S}),n()],r.prototype,"ariaLiveRegion",2);d([l({context:v}),n()],r.prototype,"activeDeferredMedia",2);r=d([T("app-provider")],r);
