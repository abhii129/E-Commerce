import{a as u}from"./-core-load-intersecting.js";import{B as m}from"./chunk-BaseElement-CopzcQ-j.js";import{H as b}from"./chunk-HTMLUpdateUtility-Hp59CDcg.js";import{n as a}from"./chunk-property-Bc0RexEQ.js";import"./chunk-lit-element-B04JoW0t.js";import"./chunk-WithApiClient-mq4vOvoR.js";import"./chunk-index-CKJCYK2x.js";import"./chunk-firstFocusableElement-BqnhZP5g.js";var g=Object.defineProperty,d=(c,e,o,r)=>{for(var t=void 0,i=c.length-1,s;i>=0;i--)(s=c[i])&&(t=s(e,o,t)||t);return t&&g(e,o,t),t};class n extends m{constructor(){super(),this.$htmlUpdateUtility=new b(this),this.page=1,this.onLoadMore=this.onLoadMore.bind(this),this.setupObservers=this.setupObservers.bind(this),this.setupObservers()}firstUpdated(e){super.firstUpdated(e),this.addEventListener("click",this.handleLoadMoreClick)}handleLoadMoreClick(e){const o=e.target;o&&o.hasAttribute("load-more-marker")&&this.onLoadMore()}setupObservers(){const e=document.querySelector("[load-more-marker]");if(e){const o={rootMargin:"-200px"};this.intersectionObserver=new IntersectionObserver(r=>{r.forEach(t=>{t.isIntersecting&&this.onLoadMore()})},o),this.intersectionObserver.observe(e),this.mutationObserver=new MutationObserver(()=>{const r=this.querySelector("product-grid-animation");document.querySelectorAll("[data-observer-loaded]").forEach(t=>{var i;(i=r.observer)==null||i.observe(t)})}),this.mutationObserver.observe(document,{childList:!0,subtree:!0})}}async onLoadMore(){var s,l,p,h;(s=document.querySelector("body"))==null||s.classList.add("overflow-hidden");const e=document.querySelector("[load-more-marker]");e==null||e.classList.remove("opacity-0");const o=await this.$htmlUpdateUtility.fetchSections({sectionIds:[this.sectionId],baseUrl:window.location.pathname,includeExistingParams:!0,withCache:!0,params:{page:this.nextPage.toString()}}),r=(l=this.$htmlUpdateUtility.parseSectionStringForSelector(o[this.sectionId],"collection-paginate"))==null?void 0:l.getAttribute("next-page");r==="false"&&e&&((p=this.intersectionObserver)==null||p.unobserve(e)),r&&(this.nextPage=parseInt(r));const t=this.$htmlUpdateUtility.parseSectionStringForSelector(o[this.sectionId],"[product-grid]"),i=document.querySelector(this.gridSelector);t&&i&&(document.startViewTransition?document.startViewTransition(()=>this.appendProductsCardsToGrid(i,t)):this.appendProductsCardsToGrid(i,t),e==null||e.classList.add("opacity-0"),(h=document.querySelector("body"))==null||h.classList.remove("overflow-hidden"))}appendProductsCardsToGrid(e,o){const r=o.children,t=new DocumentFragment;if(r){let i=!1;for(;r.length;){i=!1;for(let s=0;s<e.children.length;s++)e.children[s].getAttribute("data-key")===r[0].getAttribute("data-key")&&(i=!0);i?r[0].remove():(r[0].setAttribute("data-observer-loaded",""),t.append(r[0]))}}e.append(t),u()}}d([a({type:String,attribute:"section-id"})],n.prototype,"sectionId");d([a({type:Number})],n.prototype,"page");d([a({type:Number,attribute:"next-page"})],n.prototype,"nextPage");d([a({type:String,attribute:"grid-selector"})],n.prototype,"gridSelector");d([a({type:String,attribute:"page-url"})],n.prototype,"pageURL");window.customElements.define("collection-paginate",n);
