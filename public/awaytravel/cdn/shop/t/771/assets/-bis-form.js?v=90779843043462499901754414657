import{a as p}from"./chunk-BaseElement-CopzcQ-j.js";import{t as h}from"./chunk-custom-element-BhZVzxrc.js";import{n as l}from"./chunk-property-Bc0RexEQ.js";import"./chunk-lit-element-B04JoW0t.js";var m=Object.defineProperty,b=Object.getOwnPropertyDescriptor,r=(a,i,o,e)=>{for(var t=e>1?void 0:e?b(i,o):i,d=a.length-1,n;d>=0;d--)(n=a[d])&&(t=(e?n(i,o,t):n(t))||t);return e&&t&&m(i,o,t),t};let s=class extends p{constructor(){super(),this.publicKlaviyoId="",this.sectionId="",this.variantId="",this.countryCode="",this.errorMessage="",this.submissionStatus="",this.form=null,this.handleSubmit=async a=>{var o;if(a.preventDefault(),!this.form){this.errorMessage="Form not found";return}if(!this.publicKlaviyoId){this.errorMessage="Configuration error: Missing Klaviyo ID";return}this.submissionStatus="loading",this.errorMessage="";const i=this.querySelector("[data-bis-submit]");i==null||i.setAttribute("disabled","");try{const t=new FormData(this.form).get("bis[email]");if(!this.variantId)throw new Error("Product variant not found.");const d=`$custom:::$default:::${this.variantId}-${this.countryCode}`;if(!t||typeof t!="string"||!this.isValidEmail(t))throw new Error("Please enter a valid email address.");const n=await fetch(`https://a.klaviyo.com/client/back-in-stock-subscriptions/?company_id=${this.publicKlaviyoId}`,{method:"POST",headers:{Accept:"application/json",Revision:"2024-07-15","Content-Type":"application/json"},body:JSON.stringify({data:{type:"back-in-stock-subscription",attributes:{profile:{data:{type:"profile",attributes:{email:t}}},channels:["EMAIL"]},relationships:{variant:{data:{type:"catalog-variant",id:d}}}}})});if(!n.ok){const c=await n.json().catch(()=>null),u=this.querySelector("[data-bis-error]");throw u&&(u.textContent=(c==null?void 0:c.message)||"Subscription failed. Please try again later."),new Error((c==null?void 0:c.message)||"Subscription failed. Please try again later.")}this.submissionStatus="success",this.form.classList.add("hidden"),(o=this.querySelector("[data-bis-success]"))==null||o.classList.remove("hidden")}catch(e){this.submissionStatus="error",this.errorMessage=e instanceof Error?e.message:"An unexpected error occurred."}},this.boundHandleSubmit=this.handleSubmit.bind(this)}connectedCallback(){if(super.connectedCallback(),this.form=this.querySelector("[data-bis-form]"),!this.publicKlaviyoId){console.error("Missing required Klaviyo ID");return}this.form&&this.form.addEventListener("submit",this.boundHandleSubmit)}disconnectedCallback(){this.form&&this.form.removeEventListener("submit",this.boundHandleSubmit),super.disconnectedCallback()}isValidEmail(a){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}};r([l({type:String,attribute:"data-public-klaviyo-id"})],s.prototype,"publicKlaviyoId",2);r([l({type:String,attribute:"data-section-id"})],s.prototype,"sectionId",2);r([l({type:String,attribute:"data-variant-id"})],s.prototype,"variantId",2);r([l({type:String,attribute:"data-country-code"})],s.prototype,"countryCode",2);r([l({type:String})],s.prototype,"errorMessage",2);r([l({type:String})],s.prototype,"submissionStatus",2);s=r([h("bis-form")],s);
