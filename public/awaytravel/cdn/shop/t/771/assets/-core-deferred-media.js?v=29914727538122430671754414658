import{_ as L}from"./chunk-preload-helper-BqjOJQfC.js";import{B as S}from"./chunk-BaseElement-CopzcQ-j.js";import{c as D}from"./chunk-deferred-media-Clw3gdQB.js";import{c as b}from"./chunk-consume-B27YesmA.js";import{H as P}from"./chunk-hls-Cx0E5yqS.js";import{t as A}from"./chunk-custom-element-BhZVzxrc.js";import{n as p}from"./chunk-property-Bc0RexEQ.js";import{r as y}from"./chunk-query-async-BsMZa7Mb.js";import"./chunk-lit-element-B04JoW0t.js";import"./chunk-create-context-89xeped_.js";import"./chunk-context-request-event-GdmzvDV-.js";import"./chunk-base-CShCMygk.js";var C=Object.defineProperty,I=Object.getOwnPropertyDescriptor,r=(t,e,i,a)=>{for(var s=a>1?void 0:a?I(e,i):e,n=t.length-1,v;n>=0;n--)(v=t[n])&&(s=(a?v(e,i,s):v(s))||s);return a&&s&&C(e,i,s),s},M=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},c=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},l=(t,e,i)=>(M(t,e,"access private method"),i),_,w,m,g,f,E,h,u;const T={PAUSE:"deferred-media::pause",PLAY:"deferred-media::play"},d={ENDED:0,PLAYING:1,PAUSED:2};let o=class extends S{constructor(){super(),c(this,_),c(this,m),c(this,f),c(this,h),this.observer=null,this.playing=!1,this.loaded=!1,this.handlePosterClick=this.handlePosterClick.bind(this)}get isInlineHTML5LoopingVideo(){return this.mediaType==="video"&&this.loop&&this.autoplay}firstUpdated(t){super.firstUpdated(t),this.isInlineHTML5LoopingVideo&&!this.loadIntersecting&&l(this,h,u).call(this,!1,!1)}updated(t){super.updated(t),!(this.isInlineHTML5LoopingVideo||this.loadIntersecting)&&(this.activeDeferredMedia===this?l(this,h,u).call(this):this.pause(!0))}async connectedCallback(){super.connectedCallback();const t=await this.poster;t==null||t.addEventListener("click",this.handlePosterClick),this.loadIntersecting&&(this.observer=new IntersectionObserver(e=>{e.forEach(i=>{var a;i.isIntersecting&&(l(this,h,u).call(this),(a=this.observer)==null||a.disconnect())})}),this.observer.observe(this))}play(){this.playing||(this.$emit(T.PLAY),this.playing=!0)}pause(t=!1){if(!t){if(!this.playing)return;this.$emit(T.PAUSE)}this.playing=!1,!this.isInlineHTML5LoopingVideo&&t&&l(this,_,w).call(this)}handlePosterClick(t){t.preventDefault(),this.play()}async init(){if(this.mediaType!=="video")return;const t=await this.video;if(!t)return;if(!P.isSupported()){t.querySelectorAll("source").forEach(s=>{s.src=s.dataset.src||""});return}const e=t.querySelector('source[type="application/x-mpegURL"]');if(!(e&&e.dataset.src))return;const i=new P;i.loadSource(e.dataset.src||""),i.attachMedia(t)}async _attachHTMLVideoEvents(){const t=await this.video;t&&(t.addEventListener("pause",()=>{this.playing=!1,this.pause()}),t.addEventListener("play",()=>{this.play()}))}async _attachYoutubeEvents(){const{default:t}=await L(()=>import("./chunk-index-D9JOdh6v.js").then(i=>i.i),[]),e=await this.iframe;e&&(this.player=t(e,{playerVars:{autoplay:this.autoplay?1:0,controls:this.controls?1:0,loop:this.loop?1:0,playsinline:1,rel:0,modestbranding:1}}),this.player.getPlayerState().then(i=>{this.playing=i===d.PLAYING}),this.player.on("stateChange",i=>{switch(i.data){case d.PLAYING:this.play();break;case d.PAUSED:case d.ENDED:this.playing=!1,this.pause();break}}))}async _attachVimeoEvents(){const t=await L(()=>import("./chunk-player.es-CaHKy1aB.js"),[]),e=await this.iframe;if(!e)return;const i=new t(e,{autoplay:this.autoplay,controls:this.controls,loop:this.loop,muted:this.muted,byline:!1,title:!1});i.on("play",()=>{this.play()}),i.on("pause",()=>{this.playing=!1,this.pause()})}_initListners(){this.mediaType==="video"&&this._attachHTMLVideoEvents(),this.mediaType==="external_video"&&(this.host==="youtube"&&this._attachYoutubeEvents(),this.host==="vimeo"&&this._attachVimeoEvents())}};_=new WeakSet;w=function(){return l(this,m,g).call(this,!1)};m=new WeakSet;g=async function(t=!0){var e,i,a,s;if(this.loaded)if(this.mediaType==="video"){const n=await this.video;t?n==null||n.play():n==null||n.pause()}else this.mediaType==="external_video"&&(this.host==="youtube"?t?(e=this.player)==null||e.playVideo():(i=this.player)==null||i.pauseVideo():this.host==="vimeo"&&(t?(a=this.player)==null||a.play():(s=this.player)==null||s.pause()))};f=new WeakSet;E=function(){return l(this,m,g).call(this,!0)};h=new WeakSet;u=async function(t=!0,e=!0){if(this.loaded)l(this,f,E).call(this);else{this.loaded=!0;const i=document.createElement("div"),a=await this.template;a&&a.content.firstElementChild&&i.appendChild(a.content.firstElementChild.cloneNode(!0));const s=i.querySelector("video, iframe");if(!s)return;e?this.innerHTML=s.outerHTML:this.appendChild(s),t&&(s==null||s.focus()),s&&s.nodeName=="VIDEO"&&(this.init(),requestAnimationFrame(()=>{l(this,f,E).call(this)})),this._initListners()}};r([b({context:D,subscribe:!0})],o.prototype,"activeDeferredMedia",2);r([p({type:String})],o.prototype,"host",2);r([p({type:String,attribute:"media-type"})],o.prototype,"mediaType",2);r([p({type:Boolean,converter:t=>t==="true"})],o.prototype,"autoplay",2);r([p({type:Boolean,converter:t=>t==="true"})],o.prototype,"controls",2);r([p({type:Boolean,converter:t=>t==="true"})],o.prototype,"loop",2);r([p({type:Boolean,converter:t=>t==="true"})],o.prototype,"muted",2);r([p({type:Boolean,attribute:"load-intersecting",converter:t=>t==="true"})],o.prototype,"loadIntersecting",2);r([y('[id^="Deferred-Poster-Modal-"]')],o.prototype,"poster",2);r([y("template")],o.prototype,"template",2);r([y("video")],o.prototype,"video",2);r([y("iframe")],o.prototype,"iframe",2);o=r([A("deferred-media")],o);
