import{P as m}from"./-psn-consumer.js";import{P as h,a as u}from"./-psn-types.js";import{H as f}from"./chunk-HTMLUpdateUtility-Hp59CDcg.js";import{x as b}from"./chunk-lit-element-B04JoW0t.js";import{t as v}from"./chunk-custom-element-BhZVzxrc.js";import"./-psn-context.js";import"./chunk-create-context-89xeped_.js";import"./chunk-BaseElement-CopzcQ-j.js";import"./chunk-moneyFormatter-CIg0BGM2.js";import"./chunk-WithShopifyCart-Bw08p0rZ.js";import"./chunk-WithApiClient-mq4vOvoR.js";import"./chunk-index-CKJCYK2x.js";import"./chunk-cart-sections-DQ33OuN-.js";import"./chunk-tracking-DO2MhGcG.js";import"./chunk-consume-B27YesmA.js";import"./chunk-context-request-event-GdmzvDV-.js";import"./chunk-property-Bc0RexEQ.js";import"./chunk-state-BZNsAlxZ.js";import"./chunk-ref-7xufm7YO.js";import"./chunk-directive-C_Rw-dL6.js";import"./chunk-firstFocusableElement-BqnhZP5g.js";var I=Object.getOwnPropertyDescriptor,C=(i,t,e,r)=>{for(var s=r>1?void 0:r?I(t,e):t,o=i.length-1,a;o>=0;o--)(a=i[o])&&(s=a(s)||s);return s};let d=class extends m{constructor(){super(...arguments),this.currentStep=h.ItemPicker,this.$htmlUpdateUtility=new f(this),this.handleSlotClick=i=>{var r,s;const t=i.target.closest("[data-item-button]");if(t==null)return;(r=this.closest("psn-provider"))==null||r.classList.add("loading");const e=t.hasAttribute("is-current");if(t.dataset.itemButton&&t.dataset.itemId&&t.dataset.itemTitle&&t.dataset.itemPrice&&t.dataset.itemFeatImage){const o={id:t.dataset.itemId,price:t.dataset.itemPrice,url:t.dataset.itemButton},a=t.dataset.fee,n=t.dataset.feeId,c=t.dataset.psnTypeId,l=(s=t.closest("li"))==null?void 0:s.querySelector("#psn-additional-image-fonts"),p=JSON.parse((l==null?void 0:l.innerHTML)||"[]");this.handleItemChange(o,e,Number(a),n,t,p,c)}},this.handleButtonBorder=i=>{this.querySelectorAll("[data-item-button]").forEach(e=>{e.dataset.itemId===i?(e.setAttribute("is-current",""),e.setAttribute("disabled","")):(e.removeAttribute("is-current"),e.removeAttribute("disabled"))})},this.handleItemChange=(i,t,e=0,r="",s,o=[],a="")=>{this.handleButtonBorder(i.id),this.updateGallery(i);const n={product:t?void 0:i,fee:e,feeId:r,button:s,imageFonts:o,psnTypeId:a,fromUrl:this.psnContext.fromUrl};this.$emit(u.UpsellSelected,n)},this.updateGallery=i=>{const t=this.closest("psn-provider").querySelector("#shopify-section-psn-product");this.$htmlUpdateUtility.fetchAndReplaceSectionId({renderRoot:t,sectionId:"psn-product",baseUrl:i.url||"",params:{view:"psn"},withCache:!0,delay:100}).then(()=>{const e=new CustomEvent("main-product-change-complete",{bubbles:!0,composed:!0,detail:{isAdditional:i.id!==this.psnContext.mainProduct.id,productUrl:i.url,variantId:i.id,price:parseFloat(i.price.replace("$",""))*100}});this.dispatchEvent(e)}).catch(e=>{if(e instanceof Error)throw e;console.warn(e)})}}connectedCallback(){super.connectedCallback()}renderTemplate(){return b` <slot @click=${this.handleSlotClick}></slot> `}};d=C([v("psn-item-picker")],d);
